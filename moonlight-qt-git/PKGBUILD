# Maintainer: Michael Herzberg <{firstname}@{firstinitial}{lastname}.de>
# Contributor: SoftwareRat <jaguar5018@gmail.com>

pkgname=moonlight-qt-git
pkgver=v5.0.1.r45.g3d8de56f
pkgrel=1
pkgdesc='GameStream client for PCs (Windows, Mac, and Linux) (master branch)'
arch=('aarch64' 'x86_64')
license=('GPL')
url='https://moonlight-stream.org'
depends=('qt5-base' 'qt5-quickcontrols2' 'qt5-svg' 'ffmpeg-rockchip-git' 'sdl2_ttf')
makedepends=('git' 'pkg-config')
optdepends=('libva-intel-driver: hardware acceleration for Intel GPUs')
provides=("${pkgname%-git}")
conflicts=("${pkgname%-git}")
source=($pkgname::"git+https://github.com/moonlight-stream/${pkgname%-git}.git"
        "PR1167.patch")
md5sums=('SKIP'
         '18eeacd03b16b40f15d62598918054ee')

pkgver() {
  cd "$pkgname"
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd "$pkgname"
  git submodule update --init --recursive
  patch -p1 -N -i ../PR1167.patch
  qmake PREFIX="$pkgdir/usr" moonlight-qt.pro
}

build() {
  cd "$pkgname"
  make -j$(nproc)
}

package() {
  cd "$pkgname"
  make install
}
